Combinatorics
=========================

TODO
-------------------------

 - link to sets

Install required packages
-------------------------

[`e1071`](http://cran.r-project.org/package=e1071), [`permute`](http://cran.r-project.org/package=permute)

```{r}
wants <- c("e1071", "permute")
has   <- wants %in% rownames(installed.packages())
if(any(!has)) install.packages(wants[!has])
```

Combinations
-------------------------

### Number of $k$-combinations

${n \choose k}$

```{r}
myN <- 5
myK <- 4
choose(myN, myK)
factorial(myN) / (factorial(myK)*factorial(myN-myK))
```

### Enumerate all combinations

```{r}
combn(c("a", "b", "c", "d", "e"), myK)
combn(c(1, 2, 3, 4), 3)
```

```{r}
combn(c(1, 2, 3, 4), 3, sum)
combn(c(1, 2, 3, 4), 3, weighted.mean, w=c(0.5, 0.2, 0.3))
```

Permutations
-------------------------

### Number of permutations

```{r}
factorial(7)
```

### Random permutation

```{r}
set.seed(1.234)
set <- LETTERS[1:10]
sample(set, length(set), replace=FALSE)
```

```{r}
library(permute)
shuffle(length(set))
```

### Enumerate all permutations
#### All permutations at once
```{r}
set <- LETTERS[1:3]
len <- length(set)
library(e1071)
(mat <- permutations(len))
apply(mat, 1, function(x) set[x])
```

#### Each permutation individually

```{r}
(grp <- rep(letters[1:3], each=3))
N      <- length(grp)
nPerms <- 100
library(permute)
pCtrl <- permControl(nperm=nPerms, complete=FALSE)
for(i in 1:5) {
    perm <- permute(i, n=N, control=pCtrl)
    print(grp[perm])
}
```

#### Restricted permutations

```{r}
Njk    <- 4                                 # Zellbesetzung
P      <- 2                                 # Anzahl Stufen Faktor A
Q      <- 3                                 # Anzahl Stufen Faktor B
N      <- Njk*P*Q
nPerms <- 10             # Anzahl Permutationen
id     <- 1:(Njk*P*Q)
IV1    <- factor(rep(1:P,  each=Njk*Q))     # Faktor A
IV2    <- factor(rep(1:Q, times=Njk*P))     # Faktor B
(myDf  <- data.frame(id, IV1, IV2))

# lege Permutationsschema fuer Test von A, B fest
library(permute)                                                # fuer permControl(), permute()
pCtrlA <- permControl(strata=IV2, complete=FALSE, nperm=nPerms) # only permute across A (within B)
pCtrlB <- permControl(strata=IV1, complete=FALSE, nperm=nPerms) # only permute across B (within A)
```

fuehre Permutationen fuer Test von A, B, Interaktion durch
```{r results='hide'}
for(i in 1:3) {
    perm <- permute(i, n=N, control=pCtrlA)
    print(myDf[perm, ])
}
```

```{r results='hide'}
for(i in 1:3) {
    perm <- permute(i, n=N, control=pCtrlB)
    print(myDf[perm, ])
}
```

Enumerate all combinations of elements from different sets
-------------------------

```{r}
IV1 <- c("control", "treatment")
IV2 <- c("f", "m")
IV3 <- c(1, 2)
expand.grid(IV1, IV2, IV3)
```

Apply a function to all pairs of elements from two sets
-------------------------

```{r}
outer(1:5, 1:5, FUN="*")
```

Detach (automatically) loaded packages (if possible)
-------------------------

```{r}
try(detach(package:e1071))
try(detach(package:class))
try(detach(package:permute))
```
